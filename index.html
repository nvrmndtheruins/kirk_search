<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kirk Search</title>
    <style>
        .result-item {
            cursor: pointer;
            margin: 5px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
        }

        .result-item:hover {
            background-color: #e0e0e0;
        }

        .highlight {
            background-color: yellow;
        }

        #file-content {
            white-space: pre-wrap;
            background-color: #f9f9f9;
            padding: 15px;
            border: 1px solid #ddd;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
			
			#myBtn {
  display: none; /* Hidden by default */
  position: fixed; /* Fixed/sticky position */
  bottom: 0px; /* Place the button at the bottom of the page */
  right: 30px; /* Place the button 30px from the right */
  z-index: 99; /* Make sure it does not overlap */
  cursor: pointer; /* Add a mouse pointer on hover */
  padding: 15px; /* Some padding */
}
        }
    </style>
</head>
<body onload="loadFiles()">
<center>
<img class="logo" src="img/logo.png" alt="Kirk Search"></a>
<br>
Search Charlie Kirk and TPusa's Videos using the subtitle text with time stamps!<br>
The text before the - is the Channel and after is the video Title<br>
If the video your looking for has been removed from youtube you can find backups on the Internet Archive:<br>
<a href="https://archive.org/details/charlie-kirk-youtube-rip" target="_blank">Charlie Kirk</a>    |     
<a href="https://archive.org/details/TPUSA-youtube-rip" target="_blank">Turning Point USA</a>



<br>
<br>



    <input type="text" id="search-input" placeholder="Enter search term...">
    <button onclick="performSearch()">Search</button>
	
	</center>
	
    <div id="page">
    <div id="results"></div>
    <div id="file-content"></div>
	
	<button onclick="topFunction()" id="myBtn" title="Go to top"><img class="top" src="img/top.png" alt="Top"></a></button>
	
	</div>

    <script>
        let filesData = {};  // To store the contents of the files

        function escapeRegex(string) {
            return string.replace(/[.*+?^=!:${}()|\[\]\/\\]/g, '\\$&'); // Escape regex special characters
        }

        async function performSearch() {
            const searchTerm = escapeRegex(document.getElementById('search-input').value.trim());
            console.log("Search term:", searchTerm);  // Check if the search term is being captured
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';  // Clear any previous results

            if (searchTerm === '') {
                resultsDiv.innerHTML = '<p>Please enter a search term.</p>';
                return;
            }

            const results = [];

            // Search through all the files in the loaded JSON data
            for (const file in filesData) {
                let content = filesData[file];

                // Replace newlines with a space for easier searching
                content = content.replace(/(\r\n|\n|\r)/gm, ' ');

                const regex = new RegExp(searchTerm, 'gi');
                const matches = content.match(regex);

                if (matches) {
                    results.push({
                        file,
                        matches: matches.length
                    });
                }
            }

            // Display results
            if (results.length > 0) {
                results.forEach(result => {
                    const resultItem = document.createElement('div');
                    resultItem.classList.add('result-item');
                    resultItem.innerHTML = `<strong>${result.file}</strong><br>Found ${result.matches} match(es)`;
                    resultItem.onclick = () => openFileContent(result.file, searchTerm);
                    resultsDiv.appendChild(resultItem);
                });
            } else {
                resultsDiv.innerHTML = '<p>No matches found.</p>';
            }
        }

        async function loadFiles() {
            try {
                const response = await fetch('assets/files.json');  // Path to the JSON file
                if (!response.ok) {
                    throw new Error('Failed to fetch JSON');
                }
                const data = await response.json();
                console.log("Loaded JSON data:", data);  // Check if JSON is loaded correctly
                filesData = data;
            } catch (error) {
                console.error('Error loading files:', error);
            }
        }

        // Function to open the file content when a result is clicked
        function openFileContent(fileName, searchTerm) {
            const fileContentDiv = document.getElementById('file-content');
            fileContentDiv.innerHTML = '';  // Clear previous content

            const content = filesData[fileName];

            // Create a highlighted version of the content
            const highlightedContent = content.replace(new RegExp(searchTerm, 'gi'), (match) => {
                return `<span class="highlight">${match}</span>`;
            });

            fileContentDiv.innerHTML = highlightedContent;
            
            // Scroll to the first match
            const firstMatch = fileContentDiv.querySelector('.highlight');
            if (firstMatch) {
                firstMatch.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
    </script>
	
	<script>
	
	// Get the button:
let mybutton = document.getElementById("myBtn");

// When the user scrolls down 20px from the top of the document, show the button
window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}

// When the user clicks on the button, scroll to the top of the document
function topFunction() {
  document.body.scrollTop = 0; // For Safari
  document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
} 

</script>


</body>
</html>
